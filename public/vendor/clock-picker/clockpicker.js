/*!
 * ClockPicker v{package.version} (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/gh-pages/LICENSE)
 */
!function(){var t,i,s,e,o=window.jQuery,n=o(window),c=o(document),a="http://www.w3.org/2000/svg",r="SVGAngle"in window&&((s=document.createElement("div")).innerHTML="<svg/>",i=(s.firstChild&&s.firstChild.namespaceURI)==a,s.innerHTML="",i),h="transition"in(e=document.createElement("div").style)||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e,l="ontouchstart"in window,p="mousedown"+(l?" touchstart":""),u="mousemove.clockpicker"+(l?" touchmove.clockpicker":""),m="mouseup.clockpicker"+(l?" touchend.clockpicker":""),k=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null;function d(t){return document.createElementNS(a,t)}function f(t){return(t<10?"0":"")+t}var v=0;var g=100,b=80,w=54,y=13,x=2*g,M=h?350:1,A=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");function V(i,s){var e,n,a=o(A),h=a.find(".clockpicker-plate"),l=a.find(".clockpicker-hours"),k=a.find(".clockpicker-minutes"),V=a.find(".clockpicker-am-pm-block"),T="INPUT"===i.prop("tagName"),H=T?i:i.find("input"),P=i.find(".input-group-addon"),I=this;if(this.id=(n=++v+"",(e="cp")?e+n:n),this.element=i,this.options=s,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=T,this.input=H,this.addon=P,this.popover=a,this.plate=h,this.hoursView=l,this.minutesView=k,this.amPmBlock=V,this.spanHours=a.find(".clockpicker-span-hours"),this.spanMinutes=a.find(".clockpicker-span-minutes"),this.spanAmPm=a.find(".clockpicker-span-am-pm"),this.amOrPm="PM",this.min=null,this.max=null,this.hours=0,this.minutes=0,s.twelvehour){var S=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");o(S);o('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){I.amOrPm="AM",o(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),o('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){I.amOrPm="PM",o(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}if(s.autoclose||o('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+s.donetext+"</button>").click(o.proxy(this.done,this)).appendTo(a),s.min)if(this.min=s.min.split(":"),2!==this.min.length)this.min=null;else for(let t=0;t<this.min.length;t++)this.min[t]=+this.min[t];if(s.max)if(this.max=s.max.split(":"),2!==this.max.length)this.max=null;else{for(let t=0;t<this.max.length;t++)this.max[t]=+this.max[t];this.min&&(this.min[0]>this.max[0]||this.min[0]===this.max[0]&&this.min[1]>=this.max[1])&&(this.max=null)}"top"!==s.placement&&"bottom"!==s.placement||"top"!==s.align&&"bottom"!==s.align||(s.align="left"),"left"!==s.placement&&"right"!==s.placement||"left"!==s.align&&"right"!==s.align||(s.align="top"),a.addClass(s.placement),a.addClass("clockpicker-align-"+s.align),this.spanHours.click(o.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(o.proxy(this.toggleView,this,"minutes")),H.on("focus.clockpicker click.clockpicker",o.proxy(this.show,this)),P.on("click.clockpicker",o.proxy(this.toggle,this));var E,D,B,z,O=o('<div class="clockpicker-tick"></div>');if(s.twelvehour)for(E=1;E<13;E+=1)D=O.clone(),B=E/6*Math.PI,z=b,D.css("font-size","120%"),D.css({left:g+Math.sin(B)*z-y,top:g-Math.cos(B)*z-y}),D.html(0===E?"00":E),l.append(D),D.on(p,L);else for(E=0;E<24;E+=1){D=O.clone(),B=E/6*Math.PI;var j=E>0&&E<13;z=j?w:b,D.css({left:g+Math.sin(B)*z-y,top:g-Math.cos(B)*z-y}),j&&D.css("font-size","120%"),(this.min&&E<this.min[0]||this.max&&E>this.max[0])&&D.addClass("invalid"),D.html(0===E?"00":E),l.append(D),D.on(p,L)}for(E=0;E<60;E+=5)D=O.clone(),B=E/30*Math.PI,D.css({left:g+Math.sin(B)*b-y,top:g-Math.cos(B)*b-y}),D.css("font-size","120%"),D.html(f(E)),k.append(D),D.on(p,L);function L(i,e){var n=h.offset(),a=/^touch/.test(i.type),l=n.left+g,p=n.top+g,k=(a?i.originalEvent.touches[0]:i).pageX-l,d=(a?i.originalEvent.touches[0]:i).pageY-p,f=Math.sqrt(k*k+d*d),v=!1;if(!(o(i.target).hasClass("invalid")||e&&(f<b-y||f>b+y))){i.preventDefault();var w=setTimeout(function(){t.addClass("clockpicker-moving")},200);r&&h.append(I.canvas),I.setHand(k,d,!e,!0),c.off(u).on(u,function(t){t.preventDefault();var i=/^touch/.test(t.type),s=(i?t.originalEvent.touches[0]:t).pageX-l,e=(i?t.originalEvent.touches[0]:t).pageY-p;(v||s!==k||e!==d)&&(v=!0,I.setHand(s,e,!1,!0))}),c.off(m).on(m,function(i){c.off(m),i.preventDefault();var o=/^touch/.test(i.type),n=(o?i.originalEvent.changedTouches[0]:i).pageX-l,a=(o?i.originalEvent.changedTouches[0]:i).pageY-p;(e||v)&&n===k&&a===d&&I.setHand(n,a),"hours"===I.currentView?I.toggleView("minutes",M/2):s.autoclose&&(I.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){I.done()},M/2)),h.prepend(N),clearTimeout(w),t.removeClass("clockpicker-moving"),c.off(u)})}}if(h.on(p,function(t){0===o(t.target).closest(".clockpicker-tick").length&&L(t,!0)}),r){var N=a.find(".clockpicker-canvas"),U=d("svg");U.setAttribute("class","clockpicker-svg"),U.setAttribute("width",x),U.setAttribute("height",x);var W=d("g");W.setAttribute("transform","translate("+g+","+g+")");var X=d("circle");X.setAttribute("class","clockpicker-canvas-bearing"),X.setAttribute("cx",0),X.setAttribute("cy",0),X.setAttribute("r",2);var Y=d("line");Y.setAttribute("x1",0),Y.setAttribute("y1",0);var q=d("circle");q.setAttribute("class","clockpicker-canvas-bg"),q.setAttribute("r",y);var F=d("circle");F.setAttribute("class","clockpicker-canvas-fg"),F.setAttribute("r",3.5),W.appendChild(Y),W.appendChild(q),W.appendChild(F),W.appendChild(X),U.appendChild(W),N.append(U),this.hand=Y,this.bg=q,this.fg=F,this.bearing=X,this.g=W,this.canvas=N}C(this.options.init)}function C(t){t&&"function"==typeof t&&t()}V.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},V.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},V.prototype.locate=function(){var t=this.element,i=this.popover,s=t.offset(),e=t.outerWidth(),o=t.outerHeight(),n=this.options.placement,c=this.options.align,a={};switch(i.show(),n){case"bottom":a.top=s.top+o;break;case"right":a.left=s.left+e;break;case"top":a.top=s.top-i.outerHeight();break;case"left":a.left=s.left-i.outerWidth()}switch(c){case"left":a.left=s.left;break;case"right":a.left=s.left+e-i.outerWidth();break;case"top":a.top=s.top;break;case"bottom":a.top=s.top+o-i.outerHeight()}i.css(a)},V.prototype.show=function(i){if(!this.isShown){C(this.options.beforeShow);var s=this;this.isAppended||(t=o(document.body).append(this.popover),n.on("resize.clockpicker"+this.id,function(){s.isShown&&s.locate()}),this.isAppended=!0);var e=((this.input.prop("value")||this.options.default||"")+"").split(":");if("now"===e[0]){var a=new Date(+new Date+this.options.fromnow);e=[a.getHours(),a.getMinutes()]}this.hours=+e[0]||0,this.minutes=+e[1]||0,this.spanHours.html(f(this.hours)),this.spanMinutes.html(f(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,c.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(t){var i=o(t.target);0===i.closest(s.popover).length&&0===i.closest(s.addon).length&&0===i.closest(s.input).length&&s.hide()}),c.on("keyup.clockpicker."+this.id,function(t){27===t.keyCode&&s.hide()}),C(this.options.afterShow)}},V.prototype.hide=function(){C(this.options.beforeHide),this.isShown=!1,c.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),c.off("keyup.clockpicker."+this.id),this.popover.hide(),C(this.options.afterHide)},V.prototype.toggleView=function(t,i){var s=!1;"minutes"===t&&"visible"===o(this.hoursView).css("visibility")&&(C(this.options.beforeHourSelect),s=!0);var e="hours"===t,n=e?this.hoursView:this.minutesView,c=e?this.minutesView:this.hoursView;if(this.currentView=t,this.spanHours.toggleClass("text-primary",e),this.spanMinutes.toggleClass("text-primary",!e),c.addClass("clockpicker-dial-out"),n.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(i),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){c.css("visibility","hidden")},M),this.min||this.max){var a,r=this.minutesView.find("div.clockpicker-tick");if(this.hours||(this.hours=parseInt(this.spanHours.html())),this.minutes||(this.minutes=parseInt(this.spanMinutes.html())),e||this.hours!==this.min[0])if(e||this.hours!==this.max[0])for(let t=0;t<r.length;t++)(a=o(r[t])).removeClass("invalid");else for(let t=0;t<r.length;t++)a=o(r[t]),parseInt(a.html())>this.max[1]&&a.addClass("invalid");else for(let t=0;t<r.length;t++)a=o(r[t]),parseInt(a.html())<this.min[1]&&a.addClass("invalid")}s&&C(this.options.afterHourSelect)},V.prototype.resetClock=function(t){var i=this.currentView,s=this[i],e="hours"===i;!e&&this.min&&this.hours<=this.min[0]&&s<this.min[1]?s=this.min[1]:!e&&this.max&&this.hours>=this.max[0]&&s>this.max[1]?s=this.max[1]:e&&this.min&&s<this.min[0]?s=this.min[0]:e&&this.max&&s>this.max[0]&&(s=this.max[0]);var o=s*(Math.PI/(e?6:30)),n=e&&s>0&&s<13?w:b,c=Math.sin(o)*n,a=-Math.cos(o)*n,h=this;r&&t?(h.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){h.canvas.removeClass("clockpicker-canvas-out"),h.setHand(c,a)},t)):this.setHand(c,a)},V.prototype.setHand=function(t,i,s,e){var n,c=Math.atan2(t,-i),a="hours"===this.currentView,h=Math.PI/(a||s?6:30),l=Math.sqrt(t*t+i*i),p=this.options,u=a&&l<(b+w)/2,m=u?w:b;if(p.twelvehour&&(m=b),c<0&&(c=2*Math.PI+c),c=(n=Math.round(c/h))*h,p.twelvehour?a?0===n&&(n=12):(s&&(n*=5),60===n&&(n=0)):a?(12===n&&(n=0),n=u?0===n?12:n:0===n?0:n+12):(s&&(n*=5),60===n&&(n=0)),!(a&&(n<this.min[0]||n>this.max[0])||!a&&(this.hours<=this.min[0]&&n<this.min[1]||this.hours>=this.max[0]&&n>this.max[1])))if(this[this.currentView]!==n&&k&&this.options.vibrate&&(this.vibrateTimer||(navigator[k](10),this.vibrateTimer=setTimeout(o.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=n,this[a?"spanHours":"spanMinutes"].html(f(n)),r){e||!a&&n%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var d=Math.sin(c)*m,v=-Math.cos(c)*m;this.hand.setAttribute("x2",d),this.hand.setAttribute("y2",v),this.bg.setAttribute("cx",d),this.bg.setAttribute("cy",v),this.fg.setAttribute("cx",d),this.fg.setAttribute("cy",v)}else this[a?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=o(this);t.toggleClass("active",n===+t.html())})},V.prototype.done=function(){C(this.options.beforeDone),this.hide();var t=this.input.prop("value");Number.isInteger(this.hours)||(this.hours=parseInt(this.spanHours.html()));var i=f(this.hours)+":"+f(this.minutes);this.options.twelvehour&&(i+=this.amOrPm),this.input.prop("value",i),i!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur"),C(this.options.afterDone)},V.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(n.off("resize.clockpicker"+this.id),this.popover.remove())},o.fn.clockpicker=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var s=o(this),e=s.data("clockpicker");if(e)"function"==typeof e[t]&&e[t].apply(e,i);else{var n=o.extend({},V.DEFAULTS,s.data(),"object"==typeof t&&t);s.data("clockpicker",new V(s,n))}})}}();